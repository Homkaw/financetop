ScreenManager:
    id: screen_manager

    MainScreen:
        name: "main"

    ModuleScreen:
        name: "module_screen"

    LessonScreen:
        name: "lesson_screen"

    TestScreen:
        name: "test_screen"

    TasksScreen:
        name: "tasks_screen"

    LoginScreen:
        name: "login"

    RegisterScreenStep1:
        name: "register_step1"

    RegisterScreenStep2:
        name: "register_step2"
        
    RegisterScreenStep3:
        name: "register_step3"
        
    EditProfileScreen:
        name: "edit_profile"

    ReportScreen:
        name: "report"

    SettingsScreen:
        name: "settings"
    
    GuessWordScreen:
        name: "guess_word"

    BudgetGameScreen:
        name: "budget_game"

<MainScreen@MDScreen>:
    MDBottomNavigation:
        panel_color: "lightgreen"

        MDBottomNavigationItem:
            name: "learn"
            text: "–û–±—É—á–µ–Ω–∏–µ"
            icon: "book-open-variant"

            ScrollView:
                MDBoxLayout:
                    id: modules_container
                    orientation: "vertical"
                    padding: "12dp"
                    spacing: "12dp"
                    adaptive_height: True
                    size_hint_y: None

        MDBottomNavigationItem:
            name: "tasks"
            text: "–ó–∞–¥–∞–Ω–∏—è"
            icon: "clipboard-text"

            BoxLayout:
                orientation: "vertical"

                MDTopAppBar:
                    title: "–ó–∞–¥–∞–Ω–∏—è"

                ScrollView:
                    MDBoxLayout:
                        id: tasks_container
                        orientation: "vertical"
                        padding: "12dp"
                        spacing: "12dp"
                        adaptive_height: True
                        size_hint_y: None

        MDBottomNavigationItem:
            name: "games"
            text: "–ò–≥—Ä—ã"
            icon: "gamepad-variant"

            ScrollView:
                MDGridLayout:
                    id: games_grid
                    cols: 2
                    adaptive_height: True
                    adaptive_width: False
                    padding: "12dp"
                    spacing: "12dp"
                    size_hint_y: None
                    width: self.minimum_width

                    MDCard:
                        orientation: "vertical"
                        size_hint: 0.45, None  # ‚úÖ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —à–∏—Ä–∏–Ω–∞
                        height: "180dp"
                        radius: [12]
                        on_release: app.start_game("guess_word")
                        elevation: 6

                        FitImage:
                            source: "data/img/guess_word_banner.png"
                            size_hint_y: 0.7

                        MDLabel:
                            text: "–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ"
                            halign: "center"
                            font_style: "Caption"

                    # üü¶ –ò–≥—Ä–∞ 2: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    MDCard:
                        orientation: "vertical"
                        size_hint: 0.45, None
                        height: "180dp"
                        radius: [12]
                        on_release: app.start_game("budget_game")  # –í—ã–∑–æ–≤ –≤—Ç–æ—Ä–æ–π –∏–≥—Ä—ã
                        elevation: 6

                        FitImage:
                            source: "data/img/budget_game_banner.png"  # –ó–∞–≥–ª—É—à–∫–∞ –∏–ª–∏ —Å–≤–æ—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
                            size_hint_y: 0.7

                        MDLabel:
                            text: "–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏"
                            halign: "center"
                            font_style: "Caption"

                    



        MDBottomNavigationItem:
            name: "profile"
            text: "–ü—Ä–æ—Ñ–∏–ª—å"
            icon: "account-circle"
            on_tab_press: app.show_profile_tab()

            ScrollView:
                MDBoxLayout:
                    id: profile_container
                    orientation: "vertical"
                    padding: "16dp"
                    spacing: "20dp"
                    adaptive_height: True
                    size_hint_y: None

                    MDCard:
                        orientation: "horizontal"
                        padding: "12dp"
                        radius: [16]
                        md_bg_color: app.theme_cls.primary_light
                        size_hint_y: None
                        height: "100dp"

                        MDIcon:
                            icon: "account"
                            size_hint: None, None
                            size: "64dp", "64dp"
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.primary_color

                        MDLabel:
                            id: profile_name
                            text: "–ò–º—è –§–∞–º–∏–ª–∏—è"
                            font_style: "H6"
                            theme_text_color: "Primary"
                            halign: "left"
                            valign: "middle"

                    MDSeparator:

                    MDBoxLayout:
                        spacing: "8dp"
                        adaptive_height: True

                        MDIcon:
                            icon: "cash"
                            theme_text_color: "Secondary"

                        MDLabel:
                            id: profile_currency
                            text: "–ë–∞–ª–∞–Ω—Å: 0 –∫–µ—à–∏–∫–æ–≤"
                            halign: "left"
                            theme_text_color: "Primary"

                    MDBoxLayout:
                        spacing: "8dp"
                        adaptive_height: True

                        MDIcon:
                            icon: "progress-check"
                            theme_text_color: "Secondary"

                        MDLabel:
                            id: profile_progress
                            text: "–ü—Ä–æ–≥—Ä–µ—Å—Å: 0%"
                            halign: "left"
                            theme_text_color: "Primary"

                    MDSeparator:

                    MDRaisedButton:
                        text: "–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
                        pos_hint: {"center_x": 0.5}
                        on_release: app.edit_profile()

                    MDRaisedButton:
                        text: "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç"
                        pos_hint: {"center_x": 0.5}
                        on_release: app.root.current = "report"

                    MDRaisedButton:
                        text: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
                        pos_hint: {"center_x": 0.5}
                        on_release: app.root.current = "settings"

                    MDRaisedButton:
                        text: "–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞"
                        pos_hint: {"center_x": 0.5}
                        on_release: app.logout()

            

<ModuleScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "16dp"
        spacing: "16dp"

        MDTopAppBar:
            title: "–£—Ä–æ–∫"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]
            right_action_items: [["cash", lambda x: None, "–ö–µ—à–∏–∫–∏: {}".format(app.profile.get("currency", 0))]]
            id: topbar

        MDLabel:
            id: module_title
            text: ""
            font_style: "H5"
            halign: "center"
            theme_text_color: "Primary"
            size_hint_y: None
            adaptive_height: True
            text_size: self.width, None
            font_size: "20sp"

        MDLabel:
            id: module_desc
            text: ""
            font_style: "Body1"
            halign: "center"
            theme_text_color: "Secondary"
            size_hint_y: None
            adaptive_height: True
            text_size: self.width, None
            font_size: "16sp"

        Widget:

        MDRaisedButton:
            text: "–ù–∞—á–∞—Ç—å —É—Ä–æ–∫"
            size_hint: None, None
            size: "200dp", "48dp"
            pos_hint: {"center_x": 0.5}
            on_release: app.start_lesson()


<LessonScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "16dp"
        spacing: "12dp"

        MDTopAppBar:
            id: topbar
            title: "–£—Ä–æ–∫"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]
            right_action_items: [["cash", lambda x: None, "–ö–µ—à–∏–∫–∏: 0"]]


        ScrollView:
            MDBoxLayout:
                orientation: "vertical"
                id: lesson_content
                padding: "12dp"
                spacing: "12dp"
                adaptive_height: True
                size_hint_y: None

                MDLabel:
                    id: lesson_title
                    text: ""
                    font_style: "H6"
                    halign: "center"
                    theme_text_color: "Primary"
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width - dp(24), None  # —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏–ª—Å—è

        MDBoxLayout:
            size_hint_y: None
            height: "48dp"
            spacing: "12dp"
            padding: "12dp"
            pos_hint: {"center_x": 0.5}

            MDRaisedButton:
                text: "–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç"
                on_release: app.start_test()

            MDRaisedButton:
                text: "–ù–∞–∑–∞–¥"
                on_release: app.go_back_module()


<TestScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "16dp"
        spacing: "12dp"

        MDTopAppBar:
            title: "–¢–µ—Å—Ç"
            left_action_items: [["arrow-left", lambda x: app.go_back_module()]]
            right_action_items: [["cash", lambda x: None, "–ö–µ—à–∏–∫–∏: {}".format(app.profile.get("currency", 0))]]
            id: topbar

        ScrollView:
            MDBoxLayout:
                id: test_container
                orientation: "vertical"
                adaptive_height: True
                padding: [16, 30, 16, 16]
                spacing: "16dp"

        MDRaisedButton:
            text: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
            size_hint: None, None
            size: "200dp", "48dp"
            pos_hint: {"center_x": 0.5}
            on_release: app.check_test()


<TasksScreen@MDScreen>:
    name: "tasks_screen"

    MDBoxLayout:
        orientation: "vertical"
        padding: "12dp"
        spacing: "12dp"

        MDTopAppBar:
            title: "–ó–∞–¥–∞–Ω–∏—è –∏ –≤–∞–ª—é—Ç–∞"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]
            right_action_items: [["cash", lambda x: None, "–ö–µ—à–∏–∫–∏: {}".format(app.profile.get("currency", 0))]]
            id: topbar

        MDLabel:
            id: currency_label
            text: "–ë–∞–ª–∞–Ω—Å: {} –º–æ–Ω–µ—Ç".format(app.profile.get("currency", 0))
            halign: "center"
            font_style: "H6"
            size_hint_y: None
            adaptive_height: True
            text_size: self.width, None
            font_size: "18sp"

        ScrollView:
            MDBoxLayout:
                id: tasks_container
                orientation: "vertical"
                padding: "12dp"
                spacing: "12dp"
                adaptive_height: True
                size_hint_y: None



<LoginScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "24dp"
        spacing: "16dp"

        MDLabel:
            text: "–í—Ö–æ–¥"
            halign: "center"
            font_style: "H4"

        MDTextField:
            id: login_username
            hint_text: "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"

        MDTextField:
            id: login_password
            hint_text: "–ü–∞—Ä–æ–ª—å"
            password: True

        MDRaisedButton:
            text: "–í–æ–π—Ç–∏"
            pos_hint: {"center_x": 0.5}
            on_release: app.login(login_username.text, login_password.text)

        MDFlatButton:
            text: "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
            pos_hint: {"center_x": 0.5}
            on_release: app.change_screen("register_step1")

<RegisterScreenStep1@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "24dp"
        spacing: "16dp"

        MDLabel:
            text: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - —à–∞–≥ 1"
            halign: "center"
            font_style: "H5"

        MDTextField:
            id: reg_username
            hint_text: "–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω"

        MDTextField:
            id: reg_password
            hint_text: "–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å"
            password: True

        MDTextField:
            id: reg_password_confirm
            hint_text: "–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
            password: True

        MDRaisedButton:
            text: "–î–∞–ª–µ–µ"
            pos_hint: {"center_x": 0.5}
            on_release: app.register_step1(reg_username.text, reg_password.text, reg_password_confirm.text)

        MDFlatButton:
            text: "–ù–∞–∑–∞–¥"
            pos_hint: {"center_x": 0.5}
            on_release: app.change_screen("login")

<RegisterScreenStep2@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "24dp"
        spacing: "16dp"

        MDLabel:
            text: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - —à–∞–≥ 2 (–§–ò–û –∏ –≤–æ–∑—Ä–∞—Å—Ç)"
            halign: "center"
            font_style: "H5"

        MDTextField:
            id: reg_last_name
            hint_text: "–§–∞–º–∏–ª–∏—è"

        MDTextField:
            id: reg_first_name
            hint_text: "–ò–º—è"

        MDTextField:
            id: reg_middle_name
            hint_text: "–û—Ç—á–µ—Å—Ç–≤–æ"

        MDTextField:
            id: reg_age
            hint_text: "–°–∫–æ–ª—å–∫–æ –≤–∞–º –ª–µ—Ç"
            input_filter: "int"

        MDRaisedButton:
            text: "–î–∞–ª–µ–µ"
            pos_hint: {"center_x": 0.5}
            on_release: app.register_step2(reg_last_name.text, reg_first_name.text, reg_middle_name.text, reg_age.text)

        MDFlatButton:
            text: "–ù–∞–∑–∞–¥"
            pos_hint: {"center_x": 0.5}
            on_release: app.change_screen("register_step1")

<RegisterScreenStep3@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"
        padding: "24dp"
        spacing: "16dp"

        MDLabel:
            text: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - —à–∞–≥ 3 (–®–∫–æ–ª–∞ –∏ –∫–ª–∞—Å—Å)"
            halign: "center"
            font_style: "H5"

        MDTextField:
            id: reg_school
            hint_text: "–®–∫–æ–ª–∞"

        MDTextField:
            id: reg_grade
            hint_text: "–ö–ª–∞—Å—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7–ë)"

        MDRaisedButton:
            text: "–ó–∞–≤–µ—Ä—à–∏—Ç—å"
            pos_hint: {"center_x": 0.5}
            on_release: app.register_step3(reg_school.text, reg_grade.text)


        MDFlatButton:
            text: "–ù–∞–∑–∞–¥"
            pos_hint: {"center_x": 0.5}
            on_release: app.change_screen("register_step2")

<EditProfileScreen@MDScreen>:
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]

        ScrollView:
            MDBoxLayout:
                orientation: "vertical"
                padding: [20, 50, 20, 20]  # <<< –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É 80dp
                spacing: "16dp"
                adaptive_height: True
                size_hint_y: None

                MDTextField:
                    id: first_name
                    hint_text: "–ò–º—è"

                MDTextField:
                    id: last_name
                    hint_text: "–§–∞–º–∏–ª–∏—è"

                MDTextField:
                    id: middle_name
                    hint_text: "–û—Ç—á–µ—Å—Ç–≤–æ"

                MDTextField:
                    id: school
                    hint_text: "–®–∫–æ–ª–∞"

                MDTextField:
                    id: grade
                    hint_text: "–ö–ª–∞—Å—Å"

                MDTextField:
                    id: age
                    hint_text: "–í–æ–∑—Ä–∞—Å—Ç"
                    input_filter: "int"

                MDRaisedButton:
                    text: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
                    pos_hint: {"center_x": 0.5}
                    on_release: app.save_profile_changes()

<ReportScreen@MDScreen>:
    name:"report"
    
    MDBoxLayout:
        orientation: "vertical"

        MDTopAppBar:
            title: "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]

        MDBoxLayout:
            orientation: "vertical"
            padding: "16dp"
            spacing: "12dp"
            
            MDTextField:
                id: email_field
                hint_text: "–í–≤–µ–¥–∏—Ç–µ email"
                helper_text: "–ù–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –ø—Ä–∏–¥—ë—Ç –æ—Ç—á—ë—Ç"
                helper_text_mode: "on_focus"
                

            MDRaisedButton:
                text: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
                pos_hint: {"center_x": 0.1}
                on_release: app.generate_report()

<SettingsScreen@MDScreen>:
    name: "settings"

    MDBoxLayout:
        orientation: "vertical"
        spacing: "24dp"
        padding: "16dp"

        MDTopAppBar:
            title: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]

        Widget:  # –ü—Ä–æ—Ç–∞–ª–∫–∏–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑

        MDBoxLayout:
            orientation: "vertical"
            spacing: "16dp"
            size_hint_y: None
            height: self.minimum_height
            pos_hint: {"center_x": 0.5}

            MDRaisedButton:
                text: "–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É"
                pos_hint: {"center_x": 0.5}
                on_release: app.toggle_theme()


            MDRaisedButton:
                text: "–°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫"
                on_release: app.toggle_language()
                pos_hint: {"center_x": 0.5}

        Widget:  # –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ




<GuessWordScreen@MDScreen>:
    name: "guess_word"
    MDBoxLayout:
        orientation: "vertical"
        padding: "16dp"
        spacing: "12dp"

        MDTopAppBar:
            title: "–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]

        MDIconButton:
            icon: "lightbulb-on-outline"
            icon_size: "32sp"
            theme_text_color: "Custom"
            text_color: 1, 0.8, 0, 1
            on_release: app.show_hint()
            tooltip_text: "–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É"

        MDLabel:
            id: guess_hint
            text: "–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –∏–∑ 5 –±—É–∫–≤"
            halign: "center"
            font_style: "H6"

        


        MDTextField:
            id: guess_input
            hint_text: "–í–∞—à –≤–∞—Ä–∏–∞–Ω—Ç"
            max_text_length: 5
            size_hint_x: 0.8
            pos_hint: {"center_x": 0.5}
            multiline: False
            on_text_validate: app.submit_guess()

        ScrollView:
            MDBoxLayout:
                id: guess_output
                orientation: "vertical"
                adaptive_height: True
                spacing: "8dp"
                padding: "8dp"

        MDRaisedButton:
            text: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
            pos_hint: {"center_x": 0.5}
            on_release: app.submit_guess()

        

<BudgetGameScreen@MDScreen>:
    name: "budget_game"

    MDBoxLayout:
        orientation: "vertical"
        padding: "16dp"
        spacing: "12dp"

        MDTopAppBar:
            title: "–ò–≥—Ä–∞: –ë—é–¥–∂–µ—Ç"
            left_action_items: [["arrow-left", lambda x: app.go_back()]]

        ScrollView:
            MDBoxLayout:
                id: budget_items
                orientation: "vertical"
                spacing: "12dp"
                adaptive_height: True
                size_hint_y: None
                padding: "12dp"

        MDBoxLayout:
            size_hint_y: None
            height: "60dp"
            spacing: "12dp"
            padding: "12dp"
            pos_hint: {"center_x": 0.5}

            MDRaisedButton:
                text: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
                on_release: app.check_budget_game()

            MDIconButton:
                icon: "lightbulb-on-outline"
                icon_size: "32sp"
                theme_text_color: "Custom"
                text_color: 1, 0.8, 0, 1
                on_release: app.show_budget_hint()
                tooltip_text: "–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É"

